{% comment %}
  FluxChat - AI Shopping Assistant Widget
  This app embed loads on all pages when enabled by merchant
{% endcomment %}

<script>
  // FluxChat Configuration
  window.FluxChatConfig = {
    storeId: "{{ shop.permanent_domain | replace: '.myshopify.com', '' }}",
    apiUrl: "{{ app.api_url }}/api/chat",
    position: {{ block.settings.position | json }},
    theme: {{ block.settings.theme | json }},
    welcomeMessage: {{ block.settings.welcome_message | json }}
  };
</script>

{{ 'chat-widget.css' | asset_url | stylesheet_tag }}

<!-- Load components and services first -->
<script src="{{ 'utils-event-bus.js' | asset_url }}"></script>
<script src="{{ 'services-chat-api.js' | asset_url }}"></script>
<script src="{{ 'components-chat-button.js' | asset_url }}"></script>
<script src="{{ 'components-chat-modal.js' | asset_url }}"></script>

<!-- Load main widget last -->
<script src="{{ 'chat-widget.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "FluxChat Widget",
  "target": "body",
  "settings": [
    {
      "type": "select",
      "id": "position",
      "label": "Widget Position",
      "options": [
        {
          "value": "bottom-right",
          "label": "Bottom Right"
        },
        {
          "value": "bottom-left", 
          "label": "Bottom Left"
        }
      ],
      "default": "bottom-right"
    },
    {
      "type": "select",
      "id": "theme",
      "label": "Color Theme",
      "options": [
        {
          "value": "light",
          "label": "Light"
        },
        {
          "value": "dark",
          "label": "Dark"
        },
        {
          "value": "auto",
          "label": "Auto (Match Theme)"
        }
      ],
      "default": "light"
    },
    {
      "type": "text",
      "id": "welcome_message",
      "label": "Welcome Message",
      "default": "Hi! How can I help you find the perfect product today?"
    }
  ]
}
{% endschema %}